########################################
# 매수/매도 신호 봇 — 환경설정 (key.env)
########################################

######## 0) 런타임/게이트키퍼/관찰창/쿨다운 ########
ENABLE_OBSERVE=1
ENABLE_COOLDOWN=1
STRONG_BYPASS_SCORE=0.80
GK_TTL_HOLD_SEC=0.8

# 관찰창(초) — TF별 최소 관찰 시간 (없으면 내부 기본)
OBS_WINDOW_SEC=15m:1.5,1h:2.0,4h:2.5,1d:3.0

# 게이트키퍼 관찰시간(초) — 단일 후보만 있을 때 이 시간 경과 후 통과
GATEKEEPER_OBS_SEC=15m:20,1h:25,4h:40,1d:60
GK_DEBUG=1

# 청산 후 쿨다운(초)
POST_EXIT_COOLDOWN_SEC=15m:10,1h:30,4h:60,1d:120

# 목표 점수 도달 대기
WAIT_TARGET_ENABLE=1
TARGET_SCORE_BY_TF=15m:0.55,1h:0.60,4h:0.60,1d:0.70
WAIT_TARGET_SEC=15m:20,1h:30,4h:45,1d:60
TARGET_WAIT_MODE=SOFT  # SOFT|HARD

######## 1) 실행/거래 모드/거래소/수수료 ########
AUTO_TRADE=0                       # 1=실주문, 0=시뮬
TRADE_MODE=paper                   # paper | futures | spot
EXCHANGE_ID=binanceusdm
HEDGE_MODE=1                       # 1=듀얼(롱/숏 동시), 0=단일
FUT_MARGIN=ISOLATED
FUT_LEVERAGE=3
FUT_MIN_NOTIONAL=5
SLIPPAGE_PCT=0.7                   # 신호가격 대비 허용 미끄러짐(%)

# 수수료/펀딩 반영
USE_DYNAMIC_FEE=1                  # CCXT 마켓 테이블 우선, 없으면 아래 폴백
INCLUDE_FEES_IN_PNL=1              # PnL에 수수료 반영
ESTIMATE_FUNDING_IN_PNL=1          # PnL에 펀딩 추정 반영
FUT_TAKER_FEE_BPS=6                # 0.06% (fallback)
FUT_MAKER_FEE_BPS=2                # 0.02% (fallback)

######## 2) 심볼 선택/동시 진입/라우팅 ########
PICK_BEST_PER_TF=1                 # 동일 TF에서 BTC/ETH 중 더 좋은 쪽 1개만
PICK_W_SCORE=0.50                  # 점수 가중(0~100 → 0~0.5)

ROUTE_BY_TF=15m:AUTO,1h:AUTO,4h:AUTO,1d:AUTO
ROUTE_ALLOW=*
ROUTE_DENY=

######## 3) 총자본 & TF별 배분 ########
TOTAL_CAPITAL_USDT=2000
ALLOC_BY_TF=15m:0.10,1h:0.15,4h:0.25,1d:0.40
RESERVE_PCT=0.10                   # ALLOC 합 + RESERVE ≤ 1.0

######## 4) 강도/상위TF 가중 ########
STRENGTH_WEIGHTS=STRONG_BUY:0.80,BUY:0.55,WEAK_BUY:0.30,STRONG_SELL:0.80,SELL:0.55,WEAK_SELL:0.30
STRENGTH_BUCKETS=80:STRONG,60:BASE,0:WEAK
MTF_FACTORS=ALL_ALIGN:1.00,MAJ_ALIGN:1.25,SOME_ALIGN:1.10,NO_ALIGN:0.85,MAJ_OPPOSE:0.60,ALL_OPPOSE:0.40
FULL_ON_ALL_ALIGN=1
DEBUG_ALLOC_LOG=0

######## 5) 레버리지(전역/심볼×TF) ########
TF_LEVERAGE=15m:7,1h:5,4h:3,1d:3
LEVERAGE_BY_SYMBOL=BTC:15m=20,1h=15,4h=10,1d=5;ETH:15m=20,1h=15,4h=10,1d=5
BTC_LEVERAGE_BY_TF=15m:20;1h:15;4h:10;1d:5
ETH_LEVERAGE_BY_TF=15m:20;1h:15;4h:10;1d:5

######## 6) 마진(전역/심볼×TF) ########
TF_MARGIN=15m:ISOLATED,1h:ISOLATED,4h:ISOLATED,1d:CROSS
MARGIN_BY_SYMBOL=BTC:4h=CROSS;ETH:4h=ISOLATED
BTC_MARGIN_BY_TF=15m:CROSS;1h:CROSS;4h:CROSS;1d:CROSS
ETH_MARGIN_BY_TF=15m:ISOLATED;1h:ISOLATED;4h:ISOLATED;1d:CROSS
MARGIN_DEFAULT_BY_SYMBOL=BTC:CROSS;ETH:ISOLATED
MARGIN_DEBUG=0

######## 7) 슬리피지/TP/SL/트레일 (심볼×TF 오버라이드) ########
# (퍼센트는 RISK_MODE에 따라 '마진 수익률' 기준으로 해석될 수 있음)
SLIPPAGE_BY_SYMBOL=BTC:15m=0.5,1h=0.5,4h=0.4,1d=0.4;ETH:15m=0.8,1h=0.8,4h=0.9,1d=0.9
TP_PCT_BY_SYMBOL=BTC:15m=1.0,1h=1.8,4h=2.8,1d=4.5;ETH:15m=1.2,1h=2.4,4h=3.6,1d=5.5
SL_PCT_BY_SYMBOL=BTC:15m=0.50,1h=0.90,4h=1.20,1d=2.20;ETH:15m=0.60,1h=1.10,4h=1.60,1d=3.00
TRAIL_PCT_BY_SYMBOL=BTC:15m=0.65,1h=1.10,4h=1.60,1d=2.80;ETH:15m=0.80,1h=1.40,4h=2.00,1d=3.50

# 폴백(전역) — 심볼×TF에 없을 때 사용
TAKE_PROFIT_PCT=15m:1.2,1h:2.8,4h:4.0,1d:6.0
HARD_STOP_PCT=15m:0.6,1h:1.2,4h:2.5,1d:4.0
TRAILING_STOP_PCT=15m:0.8,1h:1.6,4h:2.0,1d:3.0

######## 8) 리스크 해석 모드 ########
# MARGIN_RETURN: 레버리지에 맞춰 '자기자본 기준 수익률(%)'을 가격 변동률로 환산하여 TP/SL/TR 계산
# PRICE_PCT: 단순 가격 변동률 기준(현물형)
RISK_MODE=MARGIN_RETURN

######## 9) 대기/재개(기본대기/일괄재개) ########
DEFAULT_PAUSE=1
AFTER_CLOSE_PAUSE=1
DAILY_RESUME_HOUR_KST=11

######## 10) 통일된 청산판정(1분봉) ########
EXIT_RESOLUTION=1m
EXIT_EVAL_MODE=TOUCH           # TOUCH | CLOSE(1m 종가)
EXIT_PRICE_SOURCE=last         # last | index | mark (mark는 last 범위 내로 클램프)
OUTLIER_MAX_1M=0.03            # 1m 데이터가 ±3% 이상 튀면 무시

######## 11) 레짐/구조 컨텍스트(1d) ########
REGIME_ENABLE=1
REGIME_TF=1d
REGIME_LOOKBACK=180
REGIME_TREND_R2_MIN=0.30
REGIME_ADX_MIN=20
STRUCT_ZIGZAG_PCT=3.0
CHANNEL_BANDS_STD=1.5
AVWAP_ANCHORS=SWING_HI,SWING_LO,LAST_BREAKOUT
CTX_ALPHA=0.35
CTX_BETA=0.50
REGIME_PLAYBOOK=1
ALERT_CTX_LINES=1
CTX_TTL_SEC=300

######## 12) 플레이북(레짐별 TP/SL/TR/배분/레버리지 보정) ########
PLAYBOOK_ENABLE=1
# 정렬(ALIGN) — 추세 추종 시 여유롭게
PB_ALIGN_TP_MUL=1.25
PB_ALIGN_SL_MUL=1.15
PB_ALIGN_TR_MUL=1.20
PB_ALIGN_ALLOC_MUL=1.25
PB_ALIGN_LEV_CAP=0
# 역추세(CONTRA) — 보수적으로
PB_CONTRA_TP_MUL=0.75
PB_CONTRA_SL_MUL=0.70
PB_CONTRA_TR_MUL=0.60
PB_CONTRA_ALLOC_MUL=0.60
PB_CONTRA_LEV_CAP=5
# 횡보(RANGE)
PB_RANGE_TP_MUL=0.80
PB_RANGE_SL_MUL=0.60
PB_RANGE_TR_MUL=0.60
PB_RANGE_ALLOC_MUL=0.80
PB_RANGE_LEV_CAP=5
PB_INTENSITY=1.00

######## 13) 플레이북 확장(하드 캡/스케일 오버라이드) ########
PLAYBOOK_HARD_LIMITS=1
PB_ALIGN_ALLOC_ABS_CAP=0
PB_CONTRA_ALLOC_ABS_CAP=300
PB_RANGE_ALLOC_ABS_CAP=200
PB_ALIGN_MAX_LEV=0
PB_CONTRA_MAX_LEV=5
PB_RANGE_MAX_LEV=7

PLAYBOOK_SCALE_OVERRIDE=1
PB_ALIGN_SCALE_STEP_MUL=1.20
PB_CONTRA_SCALE_STEP_MUL=0.70
PB_RANGE_SCALE_STEP_MUL=0.85
PB_ALIGN_SCALE_REDUCE_MUL=1.10
PB_CONTRA_SCALE_REDUCE_MUL=1.30
PB_RANGE_SCALE_REDUCE_MUL=1.10
PB_ALIGN_SCALE_MAX_LEGS_ADD=1
PB_CONTRA_SCALE_MAX_LEGS_ADD=-1
PB_RANGE_SCALE_MAX_LEGS_ADD=0
PB_ALIGN_SCALE_UP_DELTA_SHIFT=-0.05
PB_CONTRA_SCALE_UP_DELTA_SHIFT=0.10
PB_RANGE_SCALE_UP_DELTA_SHIFT=0.00
PB_ALIGN_SCALE_DOWN_DELTA_SHIFT=0.00
PB_CONTRA_SCALE_DOWN_DELTA_SHIFT=-0.05
PB_RANGE_SCALE_DOWN_DELTA_SHIFT=0.00

######## 14) 스케일링(기본) ########
SCALE_ENABLE=1
SCALE_MAX_LEGS=3
SCALE_UP_SCORE_DELTA=15m:0.5,1h:0.6,4h:0.6,1d:0.7
SCALE_DOWN_SCORE_DELTA=15m:0.6,1h:0.7,4h:0.8,1d:1.0
SCALE_STEP_PCT=15m:0.25,1h:0.25,4h:0.25,1d:0.25
SCALE_REDUCE_PCT=15m:0.20,1h:0.20,4h:0.20,1d:0.20
SCALE_MIN_ADD_NOTIONAL_USDT=15
SCALE_REALLOCATE_BRACKETS=1
SCALE_LOG=1

######## 15) 브래킷 재분배(리밸런스) ########
SCALE_BRACKETS_DEFAULT=3|0.50,0.30,0.20
SCALE_BRACKETS_ALIGN=4|0.45,0.25,0.20,0.10
SCALE_BRACKETS_CONTRA=2|0.60,0.40
SCALE_BRACKETS_RANGE=3|0.40,0.35,0.25
SCALE_REALLOC_ON_ALIGN_CHANGE=1
SCALE_REALLOC_ON_BIAS_STEP=1
SCALE_REALLOC_BIAS_STEPS=0.33,0.66
SCALE_REALLOC_COOLDOWN_SEC=600
SCALE_REALLOC_MIN_USDT=10

######## 16) 실선물 리밸런스 실행(부분청산 reduceOnly) ########
REALLOC_FUTURES_EXECUTE=1
REALLOC_ORDER_TYPE=market
REALLOC_MIN_QTY=0
REALLOC_MAX_RETRIES=2
REALLOC_RETRY_SLEEP_SEC=0.5
CSV_SCALE_EVENTS=1

######## 17) 디스코드 채널 ########
# 분석 알림 채널
CHANNEL_eth_15M=789362965258043415
CHANNEL_eth_1H=1402905696348930170
CHANNEL_eth_4H=1402905732374073374
CHANNEL_eth_1D=1402905765588635658
CHANNEL_btc_15m=1406253212461305966
CHANNEL_btc_1h=1404340510675435530
CHANNEL_btc_4h=1405370951994179634
CHANNEL_btc_1d=1404340377665798235

# 트레이드 알림 채널(없으면 심볼×TF 전용 사용)
TRADE_CHANNEL_ID=1406462194836570182
TRADE_CH_ETH_15M=1406462194836570182
TRADE_CH_ETH_1H=1406462194836570182
TRADE_CH_ETH_4H=1406462194836570182
TRADE_CH_ETH_1D=1406462194836570182
TRADE_CH_BTC_15M=1406462194836570182
TRADE_CH_BTC_1H=1406462194836570182
TRADE_CH_BTC_4H=1406462194836570182
TRADE_CH_BTC_1D=1406462194836570182
PNL_REPORT_CHANNEL_ID=1406462194836570182

########################################
# (하단) 시크릿/토큰 구역 — 별도 파일 또는 .env 하단 보관 권장
# * 절대 따옴표(") 붙이지 말고, 공백/한글/이모지 섞지 마세요 (ASCII 만!)
# BINANCE_API_KEY=
# BINANCE_SECRET=
# DISCORD_TOKEN=

########################################





